---
- name: "Install basic packages (Ubuntu)"
  apt:
    name:
      - unzip
      - tar
      - curl
      - btrfs-tools
      - libseccomp2
      - socat
      - util-linux
      - apt-transport-https
      - ca-certificates
      - software-properties-common
      - linux-headers-{{ ansible_kernel }}
      - ntp
    state: latest
  when: ansible_os_family == 'Debian'

- systemd: name=ntp state=restarted enabled=yes
  when: ansible_os_family == 'Debian'

# ---------------------------------------------

- name: "Install basic packages (CentOS)"
  yum:
    name:
      - unzip
      - tar
      - curl
      - libseccomp
      - socat
      - util-linux
      - epel-release
      - e2fsprogs
      - yum-utils
      - yum-plugin-versionlock
      - ca-certificates
      - device-mapper-persistent-data
      - lvm2
    state: latest
  when: ansible_os_family == 'RedHat'

- name: "Install basic packages (CentOS7)"
  yum:
    name:
      - btrfs-progs
      - policycoreutils-python
      - ntp
  when: ansible_os_family == 'RedHat' and ansible_distribution_major_version|int <= 7

- name: "Install basic packages (CentOS8)"
  yum:
    name:
      - python3
      - policycoreutils-python-utils
      - chrony
  when: ansible_os_family == 'RedHat' and ansible_distribution_major_version|int >= 8

- systemd: name=ntpd state=restarted enabled=yes
  when: ansible_os_family == 'RedHat' and ansible_distribution_major_version|int <= 7

- systemd: name=chronyd state=restarted enabled=yes
  when: ansible_os_family == 'RedHat' and ansible_distribution_major_version|int >= 8

# ---------------------------------------------

- name: Set NTP
  command: timedatectl set-ntp true
